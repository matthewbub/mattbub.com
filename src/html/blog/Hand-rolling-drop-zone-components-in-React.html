<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hand rolling drop-zone components in React</title>
	<meta name="description" content="Tired of that old 'Choose file' button? Yeah, me too. Let's build a proper drag-and-drop file uploader in React because it's 2024 and we deserve better UX than clicking tiny buttons like savages.">
</head>
<body>
	<h1 class="title">Hand rolling drop-zone components in React</h1>
	<p class="description">Tired of that old 'Choose file' button? Yeah, me too. Let's build a proper drag-and-drop file uploader in React because it's 2024 and we deserve better UX than clicking tiny buttons like savages.</p>
	<p class="pubDate">August 2 2024</p>
	<div class="content">
		<p>Alright so like when&rsquo;s the last time you had to actually select that old HTML &ldquo;Choose file&rdquo; button? I usually don&rsquo;t like to pull this card but <em>it is 2024 after all</em>, and since most of us are using React anyway, I figure we might as well cover what a file uploader with drag and dropping capabilities might look like.</p>

<h2 id="setup">Setup</h2>

<p>Let&rsquo;s just use Next.js because it&rsquo;s the easiest for me to reach for, plus it will be trivial to implement a backend should you decided to head that route. (You&rsquo;ll need to head that route)</p>

<p>We&rsquo;ll reach for the default settings outline in the <a href="https://nextjs.org/docs/getting-started/installation" target="_blank">Getting Started section of the Next.js docs</a>. Which basically means we should launch the create-next-app setup wizard or whatever its called.</p>

<pre><code class="language-shell">npx create-next-app@latest
</code></pre>

<p>After that, we can just dive right into the code. To be honest I was going to jump for react-dropzone like I always have in the past, but it&rsquo;s getting a bit stagnate, 2 years at the time of this writing and it looks like <a href="https://github.com/react-dropzone/react-dropzone/issues?q=is%3Aissue+is%3Aopen+BUG" target="_blank">the bugs are piling up</a>. I figure it&rsquo;s only going to grow more out of style as time goes; so it&rsquo;s probably going to be preferred to just roll our own. However if you want that option it&rsquo;s totally there. The <a href="https://github.com/react-dropzone/react-dropzone" target="_blank">source code</a> is pretty user friendly too, but I won&rsquo;t necessarily be referencing that code here, as I don&rsquo;t need that many edge cases.</p>

<p>Oh yeah, you can remove the landing page code that was auto generated in the Next.js app. All that stuff in the <code>src/app/page.tsx</code> yeah we just want the empty component. Maybe something like this</p>

<pre><code class="language-tsx">export default function Home() {
  return &lt;div&gt;Hello, World!&lt;/div&gt;;
}
</code></pre>

<h2 id="drop-zoning">Drop Zoning</h2>

<p>So I forgot to mention above that we should probably launch the dev server, because well, that&rsquo;s how we&rsquo;re going to see the changes. The command we ran to bootstrap the Next.js app should have already taken care of this for us in the <code>package.json</code> file.</p>

<p>To do that, we can execute the &ldquo;dev&rdquo; script in the <code>package.json</code> file.</p>

<pre><code class="language-sh">npm run dev
</code></pre>

<p>And with that we should have a local development server up and running. Okay now we have something to look at while we test our changes. Let&rsquo;s start by creating a new directory within the <code>src</code> directory, titled <code>components</code> or something like that.</p>

<p>Because we&rsquo;re using browser-side code. We&rsquo;re going to create an isolated module for the component that will be handling the drag and drop behavior.</p>

<pre><code class="language-tsx">&quot;use client&quot;;

import React, { useState, useRef } from &quot;react&quot;;

const FileUploader = () =&gt; {
  const [files, setFiles] = useState&lt;File[]&gt;([]);
  const dropRef = useRef&lt;HTMLDivElement&gt;(null);

  const handleDragOver = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
    event.preventDefault();
    event.stopPropagation();
    // Add visual cues (e.g., change background color) to indicate drag-over
  };

  const handleDrop = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
    event.preventDefault();
    event.stopPropagation();
    const acceptedFiles = Array.from(event.dataTransfer.files); // Filter file types if needed
    setFiles(acceptedFiles);
    // Handle file upload logic here
    console.log(acceptedFiles);
  };

  return (
    &lt;div
      className=&quot;p-4 border border-blue-500 rounded h-[300px] w-[140px]&quot;
      onDragOver={handleDragOver}
      onDrop={handleDrop}
      ref={dropRef}
    &gt;
      &lt;p&gt;Drag &amp; drop files here&lt;/p&gt;
    &lt;/div&gt;
  );
};

export default FileUploader;
</code></pre>

<p>and then we can just slap that thing up in the <code>src/app/page.tsx</code> and then test our changes with the browser dev tools tab open, because at this point in time, we&rsquo;re just logging the files being dropped into the console.</p>

<pre><code class="language-tsx">import FileUploader from &quot;@/components/FileUploader&quot;;
import React from &quot;react&quot;;

export default function Home() {
  return (
    &lt;div&gt;
      &lt;FileUploader /&gt;
    &lt;/div&gt;
  );
}
</code></pre>

<p>Cool so thats going well now we can focus on the hover state.</p>

<pre><code class="language-tsx">&quot;use client&quot;;

import React, { useState, useRef } from &quot;react&quot;;
import { Text } from &quot;@/components/text&quot;;

const FileUploader = () =&gt; {
  const [files, setFiles] = useState&lt;File[]&gt;([]);
  const [isDragging, setIsDragging] = useState(false);
  const dropRef = useRef&lt;HTMLDivElement&gt;(null);

  const handleDragOver = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
    event.preventDefault();
    event.stopPropagation();
    setIsDragging(true);
  };

  const handleDragLeave = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
    event.preventDefault();
    event.stopPropagation();
    setIsDragging(false);
  };

  const handleDrop = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
    event.preventDefault();
    event.stopPropagation();
    setIsDragging(false);
    const acceptedFiles = Array.from(event.dataTransfer.files);
    setFiles(acceptedFiles);
    // console.log(acceptedFiles)
  };

  return (
    &lt;div&gt;
      &lt;div
        className={`p-4 border border-dashed border-blue-500 rounded h-[100px] w-[300px] max-w-[300px] flex items-center justify-center ${
          isDragging ? &quot;bg-blue-500/20&quot; : &quot;&quot;
        }`}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        ref={dropRef}
      &gt;
        &lt;p&gt;Drag &amp; drop files here&lt;/p&gt;
      &lt;/div&gt;
      &lt;ul&gt;
        {files &amp;&amp;
          files.map((file, index) =&gt; &lt;Text key={index}&gt;{file.name}&lt;/Text&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
};

export default FileUploader;
</code></pre>

<p>very cool. Now let&rsquo;s work on some additional features.</p>

<h2 id="file-validation-and-error-handling">File Validation and Error Handling</h2>

<p>At this point we&rsquo;ve got a basic drop zone working, but we should probably add some validation. Let&rsquo;s say we only want to accept image files and limit the file size.</p>

<pre><code class="language-tsx">const handleDrop = (event: React.DragEvent&lt;HTMLDivElement&gt;) =&gt; {
  event.preventDefault();
  event.stopPropagation();
  setIsDragging(false);
  
  const droppedFiles = Array.from(event.dataTransfer.files);
  const validFiles: File[] = [];
  const errors: string[] = [];
  
  droppedFiles.forEach(file =&gt; {
    // Check file type
    if (!file.type.startsWith('image/')) {
      errors.push(`${file.name} is not an image file`);
      return;
    }
    
    // Check file size (5MB limit)
    if (file.size &gt; 5 * 1024 * 1024) {
      errors.push(`${file.name} is too large (max 5MB)`);
      return;
    }
    
    validFiles.push(file);
  });
  
  if (errors.length &gt; 0) {
    console.error('File validation errors:', errors);
    // You'd probably want to show these errors to the user
  }
  
  setFiles(validFiles);
};
</code></pre>

<h2 id="adding-a-traditional-file-input">Adding a Traditional File Input</h2>

<p>Because accessibility matters, we should also provide a traditional file input as a fallback. Users might prefer clicking to select files, or they might be using assistive technology.</p>

<pre><code class="language-tsx">const fileInputRef = useRef&lt;HTMLInputElement&gt;(null);

const handleFileInputChange = (event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {
  const selectedFiles = Array.from(event.target.files || []);
  setFiles(selectedFiles);
};

const handleClick = () =&gt; {
  fileInputRef.current?.click();
};

return (
  &lt;div&gt;
    &lt;div
      className={`p-4 border border-dashed border-blue-500 rounded h-[100px] w-[300px] max-w-[300px] flex items-center justify-center cursor-pointer ${
        isDragging ? &quot;bg-blue-500/20&quot; : &quot;&quot;
      }`}
      onDragOver={handleDragOver}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
      onClick={handleClick}
      ref={dropRef}
    &gt;
      &lt;p&gt;Drag &amp; drop files here or click to select&lt;/p&gt;
      &lt;input
        type=&quot;file&quot;
        ref={fileInputRef}
        onChange={handleFileInputChange}
        multiple
        accept=&quot;image/*&quot;
        style={{ display: 'none' }}
      /&gt;
    &lt;/div&gt;
    &lt;ul&gt;
      {files &amp;&amp;
        files.map((file, index) =&gt; &lt;Text key={index}&gt;{file.name}&lt;/Text&gt;)}
    &lt;/ul&gt;
  &lt;/div&gt;
);
</code></pre>

<h2 id="file-upload-implementation">File Upload Implementation</h2>

<p>Now for the actual upload part. This is where you&rsquo;d typically send the files to your backend. Here&rsquo;s a basic example:</p>

<pre><code class="language-tsx">const uploadFiles = async (filesToUpload: File[]) =&gt; {
  const formData = new FormData();
  
  filesToUpload.forEach((file, index) =&gt; {
    formData.append(`file-${index}`, file);
  });
  
  try {
    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData,
    });
    
    if (response.ok) {
      console.log('Files uploaded successfully');
      setFiles([]); // Clear the files after successful upload
    } else {
      console.error('Upload failed');
    }
  } catch (error) {
    console.error('Upload error:', error);
  }
};
</code></pre>

<h2 id="wrapping-up">Wrapping Up</h2>

<p>personally, i find joy in understanding what&rsquo;s happening under the hood. However in many production instances you&rsquo;d probably just want to reach for an open source alternative :)</p>

	</div>
</body>
</html>